---
title: Interim report - Effects of ad hoc energy newbuild award announcements on share
  prices
author: "Christian Groves eMA BEL Zeppelin University"
date: "10/4/2020"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
header-includes: \usepackage{tikz}
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, message = FALSE, warning = FALSE)
```

## Expected effects of high value EPC awards on share prices

According to the paper:

"Werteffekte durch Finanzkommunikation von Auftragseingaengen im Bereich der regenerativen Energien"  (Schiereck 2012, attached)

There are significant increases in company share values after gaining a large order for manufacturing energy generation infrastructure. This is also reflected in the paper researching share value increases for gaining EPC contracts:

"Does the stock market curse contractor’s bidding decision and winning a new contract?" 
(Choi 2015, attached)

This shows that an average of 5% are added to contract award share prices for EPC energy projects.

At the moment, the market model adjustment is used, since this appears to be the most commonly used, simple, and provides similar results to more complicated methods.

Daily stock returns are used since monthly would not show any effect and intraday stock returns would be too volatile. Furthermore only daily stock returns are both archived over several years and freely available.

Ad hoc announcements can only be sourced directly from the company websites, and not from journals or newspapers, since the announcements there are often delayed by several days and contain different information to that released on the company website.

# Method

For gaining data: 

- Define companies and events  
- Find press releases  
- Excel input  
- Define financial company and market symbols  
- Manipulate excel sheet  

For analysing data: 

- Import worksheets with R package xlsx  
- Manipulate imported data frames with R packages dplyr and magrittR  
- Call financial company and market symbols with R package quantmod  
- Convert time series with R package zoo  
- Compute with R package eventstudies  
- Print and plot results  

# Next steps

- Add 30 times as many individual events (around 2000), since only a subset of 5% are interesting (in the combination of low market capitalization and high contract value).

- Write "for loops" to allow regressions with individual share price increases from all events.

- Write code to calculate market capitalisation (as required by the the most promising correlation).

- Focus more on listed companies with a lower market capitalisation

- Project housekeeping, since data files are not organized. This is necessary to allow for unforseen events.

- Develop a functioning backend to manipulate and store the database. Currently most of the data management is still by hand in excel.

- Write out the text in the thesis, explaining basis on reviews of previous event studies, such as the advantages of large data sample sizes over complex statistical adjustments.

- Find a template in preferrably Rmarkdown or LaTeX for the thesis.

# For this reason the following hypotheses are to be examined:

### Positive short-term market reaction to contract awards
    
Not enough data

### Positive cumulative abnormal return from contract awards  
    
Not enough data

### Short-term market reaction is higher than cumulative abnormal return
    
Not enough data

### Magnitude of share price change is related to ratio of relative value of contract award compared to market capitalization  

Listing the market symbols used and the number of results analysed:  
 
```{r Wmcap, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(scales)
library(dplyr)
#package for reading and writing excel files: https://cran.r-project.org/web/packages/xlsx/xlsx.pdf
library(xlsx)
wb<-loadWorkbook('C:/Users/Christian/OneDrive/Rstudio/try1/EventDates.xlsx')
#loads sheets from workbook wb
sheets<-getSheets(wb)
#loads only first sheet from wb
sheet<-sheets[[6]]
#loads data from sheet 1 into EventDates
EventDates<-readColumns(sheet = sheet, 1, 2, 1, colClasses =c("character","Date"))
#converts first column from class Factor to class Character (no reason why it is converted to factor) with the package dplyr)
EventDates %>% mutate_if(is.factor, as.character) -> EventDates
#makes a new data frame called EventCount
EventCount<-EventDates
library(eventstudies)
library(TTR)
library(quantmod)
library(shiny)
MarketSymbol <- "^DJI"
EventSymbols <- levels(factor(EventDates$name))
YahooSymbols <- EventSymbols
print(YahooSymbols)
EventWindow <- 7
MinDate <- min(EventDates$when) - EventWindow - 365
MaxDate <- max(EventDates$when) + EventWindow + 60
AggregateStocks = lapply(YahooSymbols, function(sym) dailyReturn(na.omit(getSymbols(sym, from = MinDate, to = MaxDate, auto.assign = FALSE))))
SymbolReturns <- do.call(merge, AggregateStocks)
colnames(SymbolReturns) <- YahooSymbols
MarketReturns = dailyReturn(na.omit(getSymbols(MarketSymbol, from = MinDate, to = MaxDate, auto.assign = FALSE)))
colnames(MarketReturns) <- MarketSymbol
SymbolReturnsZoo <- as.zoo(SymbolReturns*100)
MarketReturnsZoo <- as.zoo(MarketReturns)
EventResults<-eventstudy(firm.returns = SymbolReturnsZoo, event.list=EventDates, event.window=EventWindow, type="marketModel",to.remap= TRUE, remap = "cumsum", inference = TRUE, inference.strategy = "bootstrap", model.args = list(market.returns = MarketReturnsZoo))
cat("Event outcome has",length(which(EventResults$outcomes=="success")), "successful outcomes out of", length(EventResults$outcomes),"events:")
plot(EventResults)
```

The solid line is the average gain, with the dotted lines showing the 5th and 95th percentile of other results. The idea is that if the sold and the dotted lines are all positive due to the event, and the sample size would be large enough, the event would be significant. It's a simple idea which is fairly clear.

### Correlation between perceived degree of company homogeneity in contract area and positive market reaction  
  
This will not be possible to see, since most listed companies in energy power generation are also very diverse (for example Siemens, General Electric, Mitsubishi Heavy Industries).

### Different magnitudes of correlation for different energy generation types  
  
At the moment only gas turbine generation has been looked into for most of the current sample base.

### Correlation between market reaction and market conditions  
  
It is difficult to find a common market for international cooperations in many different fields. Maybe possible to take an index such as Dow Jones Industrial and use the monthly (20 day) index average to determine if a "bull" or "bear" market is present.

### Correlation between market reaction and proportion of yearly installed capacity  
  
Not yet investigated, only the years 2017 / 2018 / 2019 can be investigated due to the availability of archived ad hoc announcements. Therefore only the three years can be compared.

### Higher results for Gigawatt projects (Energy production capacity is higher than 1 GW)

```{r Gigawatt, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(scales)
library(dplyr)
#package for reading and writing excel files: https://cran.r-project.org/web/packages/xlsx/xlsx.pdf
library(xlsx)
wb<-loadWorkbook('C:/Users/Christian/OneDrive/Rstudio/try1/EventDates.xlsx')
#loads sheets from workbook wb
sheets<-getSheets(wb)
#loads only first sheet from wb
sheet<-sheets[[5]]
#loads data from sheet 1 into EventDates
EventDates<-readColumns(sheet = sheet, 1, 2, 1, colClasses =c("character","Date"))
#converts first column from class Factor to class Character (no reason why it is converted to factor) with the package dplyr)
EventDates %>% mutate_if(is.factor, as.character) -> EventDates
#makes a new data frame called EventCount
EventCount<-EventDates
library(eventstudies)
library(TTR)
library(quantmod)
library(shiny)
MarketSymbol <- "^DJI"
EventSymbols <- levels(factor(EventDates$name))
YahooSymbols <- EventSymbols
print(YahooSymbols)
EventWindow <- 7
MinDate <- min(EventDates$when) - EventWindow - 365
MaxDate <- max(EventDates$when) + EventWindow + 60
AggregateStocks = lapply(YahooSymbols, function(sym) dailyReturn(na.omit(getSymbols(sym, from = MinDate, to = MaxDate, auto.assign = FALSE))))
SymbolReturns <- do.call(merge, AggregateStocks)
colnames(SymbolReturns) <- YahooSymbols
MarketReturns = dailyReturn(na.omit(getSymbols(MarketSymbol, from = MinDate, to = MaxDate, auto.assign = FALSE)))
colnames(MarketReturns) <- MarketSymbol
SymbolReturnsZoo <- as.zoo(SymbolReturns*100)
MarketReturnsZoo <- as.zoo(MarketReturns)
EventResults<-eventstudy(firm.returns = SymbolReturnsZoo, event.list=EventDates, event.window=EventWindow, type="marketModel",to.remap= TRUE, remap = "cumsum", inference = TRUE, inference.strategy = "bootstrap", model.args = list(market.returns = MarketReturnsZoo))
cat("Event outcome has",length(which(EventResults$outcomes=="success")), "successful outcomes out of", length(EventResults$outcomes),"events:")
plot(EventResults)
```

This shows a good correlation, may also be because of the induced high market capitalization to power ratio.

### Higher returns for turnkey EPC contracts

Please note only very few turnkey contracts are present in the sample size

Below part of the dataset used can also be seen. Stock market data starts in 2017, since the estimation period starts from the start of all of the data provided. This is due to the way that the R package "eventstudies" calculates the results. For this reason the estimation period length depends on the start of the pre-event window, with a shorter evstimation period for earlier events and a longer estimation period for later events:

Early Event:  
Start of data ¦ Estimation period ¦ Pre-Event Window ¦ Post-Event Window ¦  
Late event:  
Start of data ¦ +++++++++++++ Estimation period +++++++++++++ ¦ Pre-Event Window ¦ Post-Event Window ¦

Hence the estimation period to calculate the normal returns are not conistent in the current model.

```{r turnkey, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(scales)
library(dplyr)
#package for reading and writing excel files: https://cran.r-project.org/web/packages/xlsx/xlsx.pdf
library(xlsx)
wb<-loadWorkbook('C:/Users/Christian/OneDrive/Rstudio/try1/EventDates.xlsx')
#loads sheets from workbook wb
sheets<-getSheets(wb)
#loads only first sheet from wb
sheet<-sheets[[3]]
#loads data from sheet 1 into EventDates
EventDates<-readColumns(sheet = sheet, 1, 2, 1, colClasses =c("character","Date"))
#converts first column from class Factor to class Character (no reason why it is converted to factor) with the package dplyr)
EventDates %>% mutate_if(is.factor, as.character) -> EventDates
#makes a new data frame called EventCount
EventCount<-EventDates
#package for analysis of event studies: https://rdrr.io/cran/eventstudies/f/inst/doc/eventstudies.pdf
library(eventstudies)
#package for adding financial indicators (not currently used)
library(TTR)
#select market method symbol, so it can be called from Yahoo!Finance. Please check first that the symbol is correct!
#package for loading financial data from Yahoo! finance: https://cran.r-project.org/web/packages/quantmod/quantmod.pdf
library(quantmod)
#package for displaying variable chart data app: https://shiny.rstudio.com/tutorial/written-tutorial/lesson6/
library(shiny)
#set market symbol for Market Model index:
MarketSymbol <- "^DJI"
#list all of the stock market symbols, so they can be called from Yahoo!Finance. Please check first that the symbols are correct!
EventSymbols <- levels(factor(EventDates$name))
#Add MarketSymbol (Ticker for Market Method)
#YahooSymbols <- append(EventSymbols, MarketSymbol)
YahooSymbols <- EventSymbols
#length() shows how many symbols have been listed:
print(YahooSymbols)
#Define the Event Window Length in days:
EventWindow <- 7
#find minimum date needed for event study and take a week from it for security:
MinDate <- min(EventDates$when) - EventWindow - 180
#find maximum date needed for event study and adds ten years tp it to make the date a less significant factor security:
MaxDate <- max(EventDates$when) + EventWindow + 60
#Combine "Symbols" (tickers) with the "lapply" function from the "dplyr" package as given in https://stackoverflow.com/questions/24377590/getsymbols-downloading-data-for-multiple-symbols-and-calculate-returns:
#use lapply to list the different stocks together. Note the argument "auto.assign" must be = FALSE, otherwise results give an error.
#dailyReturn takes the % change in the closing share price. This has only been taken out of convenience.
AggregateStocks = lapply(YahooSymbols, function(sym) dailyReturn(na.omit(getSymbols(sym, from = MinDate, to = MaxDate, auto.assign = FALSE))))
#AggregateStocks is not a usable dataframe (please DON'T try "head(AggregateStocks)")! So we will merge the dataframe to give us a usable dataframe:
SymbolReturns <- do.call(merge, AggregateStocks)
#the data frame columns must be renamed to match the symbols. Source is in-built R functionality from http://www.cookbook-r.com/Manipulating_data/Renaming_columns_in_a_data_frame/
#The Columns in  SymbolReturns are not related to the tickers any more.
#
#The Columns in  SymbolReturns are not related to the tickers any more. 
#To rename the columns to be the same as the data called up by "YahooSymbols":
colnames(SymbolReturns) <- YahooSymbols
#
#Now to 
MarketReturns = dailyReturn(na.omit(getSymbols(MarketSymbol, from = MinDate, to = MaxDate, auto.assign = FALSE)))
#
colnames(MarketReturns) <- MarketSymbol
#the data frame columns must be renamed to match the symbols. Source is in-built R functionality from http://www.cookbook-r.com/Manipulating_data/Renaming_columns_in_a_data_frame/
#
#All the date in the data.frames are currently in xts format, however the package "Eventstudies" requires dates of zoo class. Converting with the fuction as.zoo:
SymbolReturnsZoo <- as.zoo(SymbolReturns*100)
MarketReturnsZoo <- as.zoo(MarketReturns)
#
#show the type of file and first entries of SymbolReturns:
print(str(SymbolReturns))
print(head(SymbolReturns))
#This provides a simple plot of the data:
#(SymbolReturns)
#save data as .xlsx file using xlsx package:
write.xlsx(SymbolReturns,'C:/Users/Christian/OneDrive/Rstudio/try1/SymbolReturns2.xlsx')
#loads data into EventStudy package function EventResults
turnkey<-eventstudy(firm.returns = SymbolReturnsZoo, event.list=EventDates, event.window=EventWindow, type="marketModel", to.remap= TRUE, remap = "cumsum", inference = TRUE, inference.strategy = "bootstrap", model.args = list(market.returns = MarketReturnsZoo))
#plots event results
plot(turnkey)
#print(str(EventResults))
print(turnkey)
```

Above the results for the 14 day event window shown in the graph are printed. A 14 day event window was chosen, since it shows the most agreeable results (highest positive change and lowest spread). This is composed of a 7 day pre-event window and a 7 day post-event window.

### Effect difference for higher value projects (above $ 500 million)

```{r Highvalue, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(scales)
library(dplyr)
#package for reading and writing excel files: https://cran.r-project.org/web/packages/xlsx/xlsx.pdf
library(xlsx)
wb<-loadWorkbook('C:/Users/Christian/OneDrive/Rstudio/try1/EventDates.xlsx')
#loads sheets from workbook wb
sheets<-getSheets(wb)
#loads only first sheet from wb
sheet<-sheets[[4]]
#loads data from sheet 1 into EventDates
EventDates<-readColumns(sheet = sheet, 1, 2, 1, colClasses =c("character","Date"))
#converts first column from class Factor to class Character (no reason why it is converted to factor) with the package dplyr)
EventDates %>% mutate_if(is.factor, as.character) -> EventDates
#makes a new data frame called EventCount
EventCount<-EventDates
library(eventstudies)
library(TTR)
library(quantmod)
library(shiny)
MarketSymbol <- "^DJI"
EventSymbols <- levels(factor(EventDates$name))
YahooSymbols <- EventSymbols
print(YahooSymbols)
EventWindow <- 7
MinDate <- min(EventDates$when) - EventWindow - 365
MaxDate <- max(EventDates$when) + EventWindow + 60
AggregateStocks = lapply(YahooSymbols, function(sym) dailyReturn(na.omit(getSymbols(sym, from = MinDate, to = MaxDate, auto.assign = FALSE))))
SymbolReturns <- do.call(merge, AggregateStocks)
colnames(SymbolReturns) <- YahooSymbols
MarketReturns = dailyReturn(na.omit(getSymbols(MarketSymbol, from = MinDate, to = MaxDate, auto.assign = FALSE)))
colnames(MarketReturns) <- MarketSymbol
SymbolReturnsZoo <- as.zoo(SymbolReturns*100)
MarketReturnsZoo <- as.zoo(MarketReturns)
EventResults<-eventstudy(firm.returns = SymbolReturnsZoo, event.list=EventDates, event.window=EventWindow, type="marketModel",to.remap= TRUE, remap = "cumsum", inference = TRUE, inference.strategy = "bootstrap", model.args = list(market.returns = MarketReturnsZoo))
cat("Event outcome has",length(which(EventResults$outcomes=="success")), "successful outcomes out of", length(EventResults$outcomes),"events:")
plot(EventResults)
```

The difference is insignificant, even though the most opportune timeframe is chosen.

### Correlation with exposure of project (hits in Google adjusted to age of announcement)  

Will not be tested since it is not known how this could be quantified.

## Background

THis will be added at a late date, explaining basic principles of the power generation business, such as the reasons and significance of EPC (Engineering, Procurement and Construction) contracts. This will be written last, since it does not affect the results and is dependant on the results to remain in context.

### Requirement of construction consortiums in EPC contracts leads to consequent reduced company involvement in any ad-hoc announcements

It is difficult to determine which companies in consortiums have the most benefit. In many cases several companies are involved - such as in the case of Marubeni (Japanese construction company) always partnering with GE for newbuilds. For this reason, many events will be included double - when several different companies are involved. 

### Highly cyclical nature of power generation newbuilds

```{r seasonality, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(scales)
library(dplyr)
#package for reading and writing excel files: https://cran.r-project.org/web/packages/xlsx/xlsx.pdf
library(xlsx)
wb<-loadWorkbook('C:/Users/Christian/OneDrive/Rstudio/try1/EventDates.xlsx')
#loads sheets from workbook wb
sheets<-getSheets(wb)
#loads only first sheet from wb
sheet<-sheets[[1]]
#loads data from sheet 1 into EventDates
EventDates<-readColumns(sheet = sheet, 1, 2, 1, colClasses =c("character","Date"))
#converts first column from class Factor to class Character (no reason why it is converted to factor) with the package dplyr)
EventDates %>% mutate_if(is.factor, as.character) -> EventDates
#makes a new data frame called EventCount
EventCount<-EventDates
#Adds a column to the data frame which categorises the events by month
EventCount$month<-as.Date(cut(EventCount$when, breaks = "month"))
#Lists events as they occur per month
seasonality<-ggplot(data = EventCount, aes(month,1)) + stat_summary(fun.y = sum, geom = "bar") + scale_x_date (labels = date_format("%Y"),breaks = "1 year") + labs(title="Seasonality of ad hoc announcements",x="months of the year",y="occurances per month")
plot(seasonality)
```

This shows there were very few newbuilds (contract awards) in 2018, but many in 2019. More data is needed to be able to draw any assumptions based on market response and market conditions.

### High level of corporate involvement in proposal stage before contract awards, and that EPCs are high risk, high margin contracts

This will be discussed in a literature review of a paper describing the risks of EPC contracts (Pichaet al., 2015, attached)

## Comparison of two different models  

Two different packages in R were compared, R package "eventstudies" and R package "estudy2". Both produced the same resutls when looking at the design case for the package "estudy2", which compares the decreased share price of several US insurance companies after the attacks of 9/11/2001.

No significant datasets could be found for event studies with events occuring on different dates (such as mergers & adquisitions) which would allow verification of the R package "eventstudies" for a similar type of dataset to which is looked at in this thesis.

## Results

The results when looking at all of the events combined  with the "market model" based on the Dow Jones Industrial Index is:

```{r Mainresults, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(scales)
library(dplyr)
#package for reading and writing excel files: https://cran.r-project.org/web/packages/xlsx/xlsx.pdf
library(xlsx)
wb<-loadWorkbook('C:/Users/Christian/OneDrive/Rstudio/try1/EventDates.xlsx')
#loads sheets from workbook wb
sheets<-getSheets(wb)
#loads only first sheet from wb
sheet<-sheets[[1]]
#loads data from sheet 1 into EventDates
EventDates<-readColumns(sheet = sheet, 1, 2, 1, colClasses =c("character","Date"))
#converts first column from class Factor to class Character (no reason why it is converted to factor) with the package dplyr)
EventDates %>% mutate_if(is.factor, as.character) -> EventDates
#makes a new data frame called EventCount
EventCount<-EventDates
library(eventstudies)
library(TTR)
library(quantmod)
library(shiny)
MarketSymbol <- "^DJI"
EventSymbols <- levels(factor(EventDates$name))
YahooSymbols <- EventSymbols
print(YahooSymbols)
EventWindow <- 7
MinDate <- min(EventDates$when) - EventWindow - 365
MaxDate <- max(EventDates$when) + EventWindow + 60
AggregateStocks = lapply(YahooSymbols, function(sym) dailyReturn(na.omit(getSymbols(sym, from = MinDate, to = MaxDate, auto.assign = FALSE))))
SymbolReturns <- do.call(merge, AggregateStocks)
colnames(SymbolReturns) <- YahooSymbols
MarketReturns = dailyReturn(na.omit(getSymbols(MarketSymbol, from = MinDate, to = MaxDate, auto.assign = FALSE)))
colnames(MarketReturns) <- MarketSymbol
SymbolReturnsZoo <- as.zoo(SymbolReturns*100)
MarketReturnsZoo <- as.zoo(MarketReturns)
EventResults<-eventstudy(firm.returns = SymbolReturnsZoo, event.list=EventDates, event.window=EventWindow, type="marketModel",to.remap= TRUE, remap = "cumsum", inference = TRUE, inference.strategy = "bootstrap", model.args = list(market.returns = MarketReturnsZoo))
cat("Event outcome has",length(which(EventResults$outcomes=="success")), "successful outcomes out of", length(EventResults$outcomes),"events:")
plot(EventResults)
```

This looks different to the results without the "market model":

```{r noMarketModel, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(scales)
library(dplyr)
#package for reading and writing excel files: https://cran.r-project.org/web/packages/xlsx/xlsx.pdf
library(xlsx)
wb<-loadWorkbook('C:/Users/Christian/OneDrive/Rstudio/try1/EventDates.xlsx')
#loads sheets from workbook wb
sheets<-getSheets(wb)
#loads only first sheet from wb
sheet<-sheets[[1]]
#loads data from sheet 1 into EventDates
EventDates<-readColumns(sheet = sheet, 1, 2, 1, colClasses =c("character","Date"))
#converts first column from class Factor to class Character (no reason why it is converted to factor) with the package dplyr)
EventDates %>% mutate_if(is.factor, as.character) -> EventDates
#makes a new data frame called EventCount
EventCount<-EventDates
library(eventstudies)
library(TTR)
library(quantmod)
library(shiny)
MarketSymbol <- "^DJI"
EventSymbols <- levels(factor(EventDates$name))
YahooSymbols <- EventSymbols
print(YahooSymbols)
EventWindow <- 7
MinDate <- min(EventDates$when) - EventWindow - 365
MaxDate <- max(EventDates$when) + EventWindow + 60
AggregateStocks = lapply(YahooSymbols, function(sym) dailyReturn(na.omit(getSymbols(sym, from = MinDate, to = MaxDate, auto.assign = FALSE))))
SymbolReturns <- do.call(merge, AggregateStocks)
colnames(SymbolReturns) <- YahooSymbols
MarketReturns = dailyReturn(na.omit(getSymbols(MarketSymbol, from = MinDate, to = MaxDate, auto.assign = FALSE)))
colnames(MarketReturns) <- MarketSymbol
SymbolReturnsZoo <- as.zoo(SymbolReturns*100)
MarketReturnsZoo <- as.zoo(MarketReturns)
EventResults<-eventstudy(firm.returns = SymbolReturnsZoo, event.list=EventDates, event.window=EventWindow, type="None",to.remap= TRUE, remap = "cumsum", inference = TRUE, inference.strategy = "bootstrap", model.args = list(market.returns = MarketReturnsZoo))
cat("Event outcome has",length(which(EventResults$outcomes=="success")), "successful outcomes out of", length(EventResults$outcomes),"events:")
plot(EventResults)
```

Here the market model performs better. However, this is based on the assumption that a similar index applies to all companies. Since many companies are listed in Hong Kong and South Korea, and not just in the USA, it may be necessary to remove the market model adjustment.

End of document
